<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stork Oracle Run</title>
<style>
*{box-sizing:border-box;}
html,body{height:100%;margin:0;font-family:Segoe UI,Tahoma,sans-serif;color:#fff;background:#050505;overflow:hidden;}
#game-container{
  position:relative;
  width:100%;
  max-width:450px;
  height:100vh;
  margin:0 auto;
  border:2px solid #00ff9d;
  background:#0d1117;
  overflow:hidden;
}
canvas{display:block;width:100%;height:100%;}
#ui-layer{position:absolute;top:8px;left:8px;right:8px;display:flex;justify-content:space-between;z-index:20;pointer-events:none;}
.hud-box{background:rgba(0,0,0,0.45);padding:6px 10px;border-radius:8px;font-size:18px;}
#start-screen,#game-over-screen{position:absolute;inset:0;background:rgba(0,0,0,0.9);backdrop-filter:blur(4px);z-index:30;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;}
#logo{width:120px;margin-bottom:12px;}
h1{color:#00ff9d;margin:0 0 10px;font-size:28px;letter-spacing:2px;text-transform:uppercase;text-shadow:0 0 12px #00ff9d;}
.instructions{background:rgba(255,255,255,0.04);padding:12px;border-radius:8px;color:#ccc;line-height:1.6;margin-bottom:18px;}
button{background:linear-gradient(45deg,#00ff9d,#00cc7e);border:none;padding:12px 28px;border-radius:36px;font-weight:700;cursor:pointer;}
.x-btn{background:#000;color:#fff;border:1px solid #333;padding:10px 18px;border-radius:36px;}
#game-over-character{width:160px;margin-bottom:10px;}
.hidden{display:none!important;}
.note{position:absolute;bottom:8px;left:8px;color:rgba(255,255,255,0.35);font-size:12px;z-index:25;}
.mobile-controls{position:fixed;bottom:20px;width:100%;display:flex;justify-content:space-between;pointer-events:auto;z-index:35;padding:0 20px;}
.mobile-btn{width:120px;height:80px;background:#00ff9d;opacity:0.35;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:bold;user-select:none;}
@media (min-width:768px){.mobile-controls{display:none;}}
#made-by{position:absolute;bottom:5px;width:100%;text-align:center;font-size:12px;color:rgba(255,255,255,0.5);}

/* ŸÖŸàÿ®ÿß€åŸÑ ÿßÿ±ÿ™ŸÅÿßÿπ ⁄©ŸÖÿ™ÿ± ÿ®ÿ±ÿß€å ÿØ⁄©ŸÖŸá‚ÄåŸáÿß */
@media (max-width:767px){
  #game-container {height:77vh;}
}
</style>
</head>
<body>
<div id="game-container">
  <div id="ui-layer">
    <div id="score-board" class="hud-box">Data: 0</div>
    <div id="health-board" class="hud-box">ü•ö ü•ö ü•ö</div>
    <div id="shield-timer" class="hud-box">Shield: 0.0s</div>
  </div>

  <div id="start-screen">
    <img id="logo" src="logo.png" alt="logo">
    <h1>STORK ORACLE</h1>
    <div class="instructions">‚ö° Collect Data ‚Äî ‚õΩ Avoid Gas Fees ‚Äî üõ°Ô∏è Shields ‚Äî üß≤ Magnets!</div>
    <button id="start-btn">START GAME</button>
  </div>

  <div id="game-over-screen" class="hidden">
    <img id="game-over-character" src="cry.png" alt="cry">
    <h1 style="color:#ff4d4d">Game Over</h1>
    <p style="font-size:18px">Final Score: <span id="final-score">0</span></p>
    <button id="try-btn">TRY AGAIN</button>
    <a id="share-link" target="_blank" style="margin-top:12px;text-decoration:none">
      <button class="x-btn">Share on X</button>
    </a>
    <div id="made-by">Made by milad1377</div>
  </div>

  <canvas id="gameCanvas" aria-label="game-canvas"></canvas>
  <div class="note">Desktop: Arrows / A-D ‚Äî Mobile: Tap Buttons</div>

  <div class="mobile-controls">
    <div id="left-btn" class="mobile-btn">‚óÄ</div>
    <div id="right-btn" class="mobile-btn">‚ñ∂</div>
  </div>
</div>

<script>
const canvas=document.getElementById('gameCanvas');
const scoreEl=document.getElementById('score-board');
const healthEl=document.getElementById('health-board');
const shieldTimerEl=document.getElementById('shield-timer');
const startScreen=document.getElementById('start-screen');
const gameOverScreen=document.getElementById('game-over-screen');
const finalScoreEl=document.getElementById('final-score');
const startBtn=document.getElementById('start-btn');
const tryBtn=document.getElementById('try-btn');
const shareLink=document.getElementById('share-link');
const gameOverCharImg=document.getElementById('game-over-character');
const leftBtn=document.getElementById('left-btn');
const rightBtn=document.getElementById('right-btn');

let ctx, images={}, gameRunning=false, score=0, health=3, frames=0, difficultyFactor=1, items=[];
let moveLeft=false, moveRight=false;
const player={x:0,y:0,width:80,height:100,speed:7,hasShield:false,shieldTimer:0,magnetTimer:0,facingRight:true};

/* Audio */
const AudioContextClass=window.AudioContext||window.webkitAudioContext;
const audioCtx=new AudioContextClass();
function playBeep(freq,dur=0.1,vol=0.2){
  const osc=audioCtx.createOscillator();
  const gain=audioCtx.createGain();
  osc.frequency.value=freq; osc.type='sine';
  gain.gain.value=vol;
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.start(); osc.stop(audioCtx.currentTime+dur);
}
function playGameOverSound(){playBeep(120,0.5,0.3); playBeep(100,0.3,0.2);}

/* Canvas */
function setupCanvasDPR(){
  const dpr=window.devicePixelRatio||1;
  const rect=canvas.getBoundingClientRect();
  canvas.width=Math.max(1,Math.floor(rect.width*dpr));
  canvas.height=Math.max(1,Math.floor(rect.height*dpr));
  canvas.style.width=rect.width+"px";
  canvas.style.height=rect.height+"px";
  ctx=canvas.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
setupCanvasDPR();
window.addEventListener('resize',setupCanvasDPR);

/* Controls */
window.addEventListener('keydown',e=>{
  if(['ArrowLeft','a','A'].includes(e.key)) moveLeft=true;
  if(['ArrowRight','d','D'].includes(e.key)) moveRight=true;
});
window.addEventListener('keyup',e=>{
  if(['ArrowLeft','a','A'].includes(e.key)) moveLeft=false;
  if(['ArrowRight','d','D'].includes(e.key)) moveRight=false;
});
leftBtn.addEventListener('touchstart',()=>{moveLeft=true; moveRight=false;},{passive:false});
leftBtn.addEventListener('touchend',()=>{moveLeft=false;},{passive:false});
rightBtn.addEventListener('touchstart',()=>{moveRight=true; moveLeft=false;},{passive:false});
rightBtn.addEventListener('touchend',()=>{moveRight=false;},{passive:false});

/* Items */
class Item{
  constructor(){
    this.size=40; this.x=Math.random()*(canvas.clientWidth-this.size);
    this.y=-this.size-Math.random()*80;
    this.speed=(3+Math.random()*2)*difficultyFactor;
    const r=Math.random();
    if(r<0.7){this.type='good';this.emoji='‚ö°';}
    else if(r<0.9){this.type='bad';this.emoji='‚õΩ';}
    else if(r<0.97){this.type='shield';this.emoji='üõ°Ô∏è';}
    else{this.type='magnet';this.emoji='üß≤';}
    this._curvePhase=Math.random()*Math.PI*2;
  }
  update(){this.y+=this.speed;}
  draw(ctx){
    ctx.font="28px Arial"; ctx.textAlign="center";
    ctx.fillStyle=this.type==='good'?'#ffeb3b':(this.type==='bad'?'#ff6b6b':(this.type==='shield'?'#00bcd4':'#ff66ff'));
    ctx.fillText(this.emoji,this.x+this.size/2,this.y+this.size/2+10);
  }
}

/* Draw Player */
function drawPlayer(){
  ctx.save();
  const cx=player.x+player.width/2;
  const cy=player.y+player.height/2;
  ctx.translate(cx,cy);
  if(!player.facingRight) ctx.scale(-1,1);

  if(player.magnetTimer>0){
    ctx.beginPath();
    const pulseRadius=Math.max(player.width,player.height)*(0.6+0.12*Math.sin(frames/6));
    ctx.arc(0,0,pulseRadius,0,Math.PI*2);
    ctx.strokeStyle='rgba(255,102,255,0.5)'; ctx.lineWidth=4; ctx.stroke();
  }

  if(player.hasShield){
    ctx.beginPath();
    ctx.arc(0,0,Math.max(player.width,player.height)*0.6,0,Math.PI*2);
    ctx.strokeStyle='rgba(0,255,200,0.7)'; ctx.lineWidth=4; ctx.stroke();
  }

  const animSpeed=10;
  const currentFrame=Math.floor(frames/animSpeed)%2;
  const spriteToDraw=(moveLeft||moveRight)?(currentFrame===0?images.player1:images.player2):images.player1;
  if(spriteToDraw) ctx.drawImage(spriteToDraw,-player.width/2,-player.height/2,player.width,player.height);
  ctx.restore();
}

/* Health Display */
function updateHealthDisplay(){
  let hearts=''; for(let i=0;i<health;i++) hearts+='ü•ö '; healthEl.innerText=hearts.trim();
}

/* Init Game */
function initGame(){
  score=0; health=3; frames=0; items=[]; difficultyFactor=1;
  player.width=Math.min(120,canvas.clientWidth*0.18);
  player.height=player.width*1.1;
  player.x=(canvas.clientWidth-player.width)/2;
  player.y=canvas.clientHeight-player.height-40;
  player.hasShield=false; player.shieldTimer=0; player.magnetTimer=0; player.facingRight=true;
  scoreEl.innerText=`Data: ${score}`; updateHealthDisplay(); shieldTimerEl.innerText='Shield: 0.0s';
}

/* Game Over */
function gameOver(){
  gameRunning=false;
  finalScoreEl.innerText=score;
  if(images.cry) gameOverCharImg.src=images.cry.src;
  playGameOverSound();
  const txt=encodeURIComponent(`I scored ${score} in @Stork Oracle Run! ‚ö°‚ö°`);
  shareLink.href=`https://twitter.com/intent/tweet?text=${txt}`;
  gameOverScreen.classList.remove('hidden');
}

/* Game Loop */
function gameLoop(){
  if(!gameRunning) return;
  ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);

  // grid
  ctx.strokeStyle='rgba(0,255,157,0.06)'; ctx.lineWidth=1;
  for(let x=0;x<canvas.clientWidth;x+=40){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,canvas.clientHeight);ctx.stroke();}
  for(let y=0;y<canvas.clientHeight;y+=40){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(canvas.clientWidth,y);ctx.stroke();}

  if(frames%(Math.max(20,48-Math.floor(difficultyFactor*5)))===0) items.push(new Item());

  if(moveLeft&&player.x>0){player.x-=player.speed; player.facingRight=true;}
  if(moveRight&&player.x<canvas.clientWidth-player.width){player.x+=player.speed; player.facingRight=false;}

  if(player.hasShield){
    player.shieldTimer--;
    shieldTimerEl.innerText=(player.shieldTimer/60).toFixed(1)+'s';
    if(player.shieldTimer<=0){player.hasShield=false; shieldTimerEl.innerText='0.0s';}
  }

  if(player.magnetTimer>0){
    player.magnetTimer--;
    const magnetRange=450; const magnetPower=0.12; const curveAmplitude=8; const wobbleSpeed=0.16;
    for(let it of items){
      if(it.type==='good'||it.type==='shield'){
        const dx=player.x+player.width/2-it.x; const dy=player.y+player.height/2-it.y;
        const dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<magnetRange){
          it.x+=dx/magnetRange*magnetPower*dist*2;
          it.y+=dy/magnetRange*magnetPower*dist*2;
          it._curvePhase+=wobbleSpeed;
          const perpX=-dy/dist, perpY=dx/dist;
          const curve=Math.sin(it._curvePhase)*(curveAmplitude*(1-dist/magnetRange));
          it.x+=perpX*curve; it.y+=perpY*curve;
        }
      }
    }
  }

  for(let i=0;i<items.length;i++){
    const it=items[i]; it.update(); it.draw(ctx);
    if(player.x<it.x+it.size && player.x+player.width>it.x && player.y<it.y+it.size && player.y+player.height>it.y){
      if(it.type==='good'){score+=10; playBeep(880);}
      else if(it.type==='shield'){player.hasShield=true; player.shieldTimer=210; playBeep(440);}
      else if(it.type==='magnet'){player.magnetTimer=520; playBeep(660);}
      else {if(!player.hasShield){health--; updateHealthDisplay(); playBeep(220); if(health<=0){items.splice(i,1); return gameOver();}}}
      items.splice(i,1); i--; continue;
    }
    if(it.y>canvas.clientHeight+50){items.splice(i,1); i--;}
  }

  drawPlayer();
  frames++; difficultyFactor+=0.0002;
  scoreEl.innerText=`Data: ${score}`;
  requestAnimationFrame(gameLoop);
}

/* Preload images */
function preloadImages(list){
  const results={};
  const promises=list.map(({name,src})=>new Promise(res=>{
    const img=new Image();
    img.onload=()=>{results[name]=img; res();};
    img.onerror=()=>{console.warn('Image failed:',src); results[name]=null; res();};
    img.src=src;
  }));
  return Promise.all(promises).then(()=>results);
}

const assetsToLoad=[
  {name:'logo',src:'logo.png'},
  {name:'player1',src:'player1.png'},
  {name:'player2',src:'player2.png'},
  {name:'cry',src:'cry.png'}
];

preloadImages(assetsToLoad).then(imgs=>{
  images=imgs;
  if(images.logo) document.getElementById('logo').src=images.logo.src;
  startBtn.addEventListener('click',()=>{initGame(); gameRunning=true; startScreen.classList.add('hidden'); gameOverScreen.classList.add('hidden'); requestAnimationFrame(gameLoop);});
  tryBtn.addEventListener('click',()=>{initGame(); gameRunning=true; startScreen.classList.add('hidden'); gameOverScreen.classList.add('hidden'); requestAnimationFrame(gameLoop);});
});
</script>
</body>
</html>
